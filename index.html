<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Sequel-rails by TalentBox</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Sequel-rails</h1>
          <h2>A gem for using Sequel with Rails 3.x and 4.x</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/TalentBox/sequel-rails/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/TalentBox/sequel-rails/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/TalentBox/sequel-rails" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a name="sequel-rails" class="anchor" href="#sequel-rails"><span class="octicon octicon-link"></span></a>sequel-rails</h1>

<p><a href="https://travis-ci.org/TalentBox/sequel-rails"><img src="https://travis-ci.org/TalentBox/sequel-rails.png?branch=master" alt="Build Status"></a>
<a href="https://codeclimate.com/github/TalentBox/sequel-rails"><img src="https://codeclimate.com/github/TalentBox/sequel-rails.png" alt="Code Climate"></a></p>

<p>This gem provides the railtie that allows
<a href="http://github.com/jeremyevans/sequel">sequel</a> to hook into
<a href="http://github.com/rails/rails">Rails (3.x and 4.x)</a> and thus behave like a
rails framework component. Just like activerecord does in rails,
<a href="http://github.com/talentbox/sequel-rails">sequel-rails</a> uses the railtie API to
hook into rails. The two are actually hooked into rails almost identically.</p>

<p>The code for this gem was initially taken from the excellent
<a href="http://github.com/datamapper/dm-rails">dm-rails</a> project.</p>

<p>This was originally a fork of <a href="https://github.com/brasten">brasten</a>'s
<a href="https://github.com/brasten/sequel-rails">sequel-rails</a> that has been updated to
support newer versions of rails.</p>

<p>Since January 2013, we've became the official maintainers of the gem after
<a href="https://github.com/brasten">brasten</a> proposed us.</p>

<h1>
<a name="using-sequel-rails" class="anchor" href="#using-sequel-rails"><span class="octicon octicon-link"></span></a>Using sequel-rails</h1>

<p>Using sequel with Rails (3.x or 4.x) requires a couple minor changes.</p>

<p>First, add the following to your Gemfile (after the <code>Rails</code> lines):</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># depending on you database</span>
<span class="n">gem</span> <span class="s2">"pg"</span>        <span class="c1"># for PostgreSQL</span>
<span class="n">gem</span> <span class="s2">"mysql2"</span>    <span class="c1"># for MySQL</span>
<span class="n">gem</span> <span class="s2">"sqlite3"</span>   <span class="c1"># for Sqlite</span>

<span class="n">gem</span> <span class="s2">"sequel-rails"</span>
</pre></div>

<p>... be sure to run "bundle install" if needed!</p>

<p>Secondly, you'll need to require the different Rails components separately in
your <code>config/application.rb</code> file, and not require <code>ActiveRecord</code>.
The top of your <code>config/application.rb</code> will probably look something like:</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># require 'rails/all'</span>

<span class="c1"># Instead of 'rails/all', require these:</span>
<span class="nb">require</span> <span class="s2">"action_controller/railtie"</span>
<span class="c1"># require "active_record/railtie"</span>
<span class="nb">require</span> <span class="s2">"action_mailer/railtie"</span>
<span class="nb">require</span> <span class="s2">"sprockets/railtie"</span>
</pre></div>

<p>Starting with sequel-rails 0.4.0.pre3 we don't change default Sequel behaviour
nor include any plugin by default, if you want to get back the previous
behaviour, you can create a new initializer (eg: <code>config/initializers/sequel.rb</code>)
with content:</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s2">"sequel_rails/railties/legacy_model_config"</span>
</pre></div>

<p>After those changes, you should be good to go!</p>

<h1>
<a name="features-provided-by-sequel-rails" class="anchor" href="#features-provided-by-sequel-rails"><span class="octicon octicon-link"></span></a>Features provided by <code>sequel-rails</code>
</h1>

<ol>
<li>
<p>Connection management:</p>

<p><code>sequel-rails</code> will initiate the <code>Sequel</code> connection mechanism based on your
configuration in <code>database.yml</code>.</p>
</li>
<li>
<p>Generators:</p>

<p>You can use them just like <code>ActiveRecord</code>'s ones:</p>

<p>Migration:</p>

<div class="highlight highlight-ruby"><pre><span class="n">rails</span> <span class="n">generate</span> <span class="n">migration</span> <span class="n">create_admin_users</span>
<span class="c1"># Or</span>
<span class="n">rails</span> <span class="n">generate</span> <span class="n">migration</span> <span class="no">CreateAdminUsers</span>
</pre></div>

<p>Model:</p>

<div class="highlight highlight-ruby"><pre><span class="n">rails</span> <span class="n">generate</span> <span class="n">model</span> <span class="no">User</span> <span class="ss">email</span><span class="p">:</span><span class="n">string</span>
</pre></div>

<p>Observer:</p>

<div class="highlight highlight-ruby"><pre><span class="n">rails</span> <span class="n">generate</span> <span class="n">observer</span> <span class="no">User</span>
</pre></div>
</li>
<li><p>Rake tasks similar to <code>ActiveRecord</code>, see
<a href="#available-sequel-specific-rake-tasks">Available sequel specific rake tasks</a></p></li>
<li>
<p>Add some <code>Sequel</code> and <code>sequel-rails</code> specific exceptions to <code>ActionDispatch</code>'s <code>rescue_responses</code></p>

<p><code>Sequel::Plugins::RailsExtensions::ModelNotFound</code> is mapped to <code>:not_found</code></p>

<p><code>Sequel::NoMatchingRow</code> is mapped to <code>:not_found</code></p>

<p><code>Sequel::ValidationFailed</code> is mapped to <code>:unprocessable_entity</code></p>

<p><code>Sequel::NoExistingObject</code> is mapped to <code>:unprocessable_entity</code></p>
</li>
<li><p>Add a <code>i18n_scope</code> method to <code>Sequel::Model</code> which respond with <code>"sequel"</code>.
This is used by <code>ActiveModel</code>.</p></li>
<li><p>Adding <code>Sequel</code> to <code>ActiveSupport::LogSubscriber</code>. This is what allows you to
see SQL queries in the log and also allows us to implement the next item.</p></li>
<li><p>Add a hook in <code>ActionController::Base</code> so that the sum of SQL queries time
for the current action is reported as <code>DB</code> for the controller's line in logs.</p></li>
</ol><h1>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h1>

<p>You can configure some options with the usual rails mechanism, in
<code>config/application.rb</code> and/or in <code>config/environments/*.rb</code>.</p>

<div class="highlight highlight-ruby"><pre>    <span class="c1"># Allowed options: :sql, :ruby.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">sequel</span><span class="o">.</span><span class="n">schema_format</span> <span class="o">=</span> <span class="ss">:sql</span>

    <span class="c1"># Whether to dump the schema after successful migrations.</span>
    <span class="c1"># Defaults to false in production and test, true otherwise.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">sequel</span><span class="o">.</span><span class="n">schema_dump</span> <span class="o">=</span> <span class="kp">true</span>

    <span class="c1"># These override corresponding settings from the database config.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">sequel</span><span class="o">.</span><span class="n">max_connections</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">config</span><span class="o">.</span><span class="n">sequel</span><span class="o">.</span><span class="n">search_path</span> <span class="o">=</span> <span class="sx">%w(mine public)</span>

    <span class="c1"># Configure whether database's rake tasks will be loaded or not</span>
    <span class="c1"># Defaults to true</span>
    <span class="n">config</span><span class="o">.</span><span class="n">sequel</span><span class="o">.</span><span class="n">load_database_tasks</span> <span class="o">=</span> <span class="kp">false</span>
</pre></div>

<p>The connection settings are read from the file <code>config/database.yml</code> and is
expected to be similar to <code>ActiveRecord</code>'s format.</p>

<p>Here's some examples:</p>

<ol>
<li>
<p>For PostgreSQL:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">development</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgresql</span>
  <span class="l-Scalar-Plain">database</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">a_database_name</span>
  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_name</span> <span class="c1"># Also accept 'username' as key, if both are present 'username' is used</span>
  <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">password</span>
  <span class="l-Scalar-Plain">host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10.0.0.2</span> <span class="c1"># Optional</span>
  <span class="l-Scalar-Plain">port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5432</span> <span class="c1"># Optional</span>
  <span class="l-Scalar-Plain">owner</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">owner_name</span> <span class="c1"># Optional</span>
  <span class="l-Scalar-Plain">encoding</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">utf8</span> <span class="c1"># Optional, also accept 'charset' as key, if both are present 'encoding' is used (defaults to 'utf8')</span>
  <span class="l-Scalar-Plain">maintenance_db</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">template2</span> <span class="c1"># Optional</span>
  <span class="l-Scalar-Plain">locale</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">en_US.UTF-8</span> <span class="c1"># Optional, equivalent to setting 'collation' and 'ctype' to the same value</span>
  <span class="l-Scalar-Plain">collation</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">en_US.UTF-8</span> <span class="c1"># Optional</span>
  <span class="l-Scalar-Plain">ctype</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">en_US.UTF-8</span> <span class="c1"># Optional</span>
  <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">template1</span> <span class="c1"># Optional</span>
  <span class="l-Scalar-Plain">tablespace</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">non_default_tablespace_name</span> <span class="c1"># Optional</span>
</pre></div>
</li>
<li>
<p>For MySQL:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">development</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">mysql</span> <span class="c1"># Also accept mysql2</span>
  <span class="l-Scalar-Plain">database</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">a_database_name</span>
  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_name</span> <span class="c1"># Also accept 'username' as key, if both are present 'username' is used</span>
  <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">password</span>
  <span class="l-Scalar-Plain">host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10.0.0.2</span> <span class="c1"># Optional</span>
  <span class="l-Scalar-Plain">port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5432</span> <span class="c1"># Optional</span>
  <span class="l-Scalar-Plain">charset</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">latin1</span> <span class="c1"># Optional (defaults to 'utf8')</span>
  <span class="l-Scalar-Plain">collation</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">latin1_general_ci</span> <span class="c1"># Optional (defaults to 'utf8_unicode_ci')</span>
</pre></div>
</li>
<li>
<p>For SQLite:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">development</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sqlite</span> <span class="c1"># Also accept sqlite3</span>
  <span class="l-Scalar-Plain">database</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">db/mydatabase.sqlite</span> <span class="c1"># Path to db relative to Rails root</span>
</pre></div>

<p>For in memory testing:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">development</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sqlite</span> <span class="c1"># Also accept sqlite3</span>
  <span class="l-Scalar-Plain">database</span><span class="p-Indicator">:</span> <span class="s">":memory:"</span>
</pre></div>
</li>
</ol><h1>
<a name="enabling-plugins" class="anchor" href="#enabling-plugins"><span class="octicon octicon-link"></span></a>Enabling plugins</h1>

<p>If you want to enable plugins for all your models, you should use the
after_connect configuration option in <code>config/application.rb</code> (0.6.2+):</p>

<div class="highlight highlight-ruby"><pre>    <span class="n">config</span><span class="o">.</span><span class="n">sequel</span><span class="o">.</span><span class="n">after_connect</span> <span class="o">=</span> <span class="nb">proc</span> <span class="k">do</span>
      <span class="ss">Sequel</span><span class="p">:</span><span class="ss">:Model</span><span class="o">.</span><span class="n">plugin</span> <span class="ss">:timestamps</span><span class="p">,</span> <span class="n">update_on_create</span><span class="p">:</span> <span class="kp">true</span>
    <span class="k">end</span>
</pre></div>

<p>This will ensure that these plugins are loaded before any Sequel models are
loaded. Loading plugins into <code>Sequel::Model</code> after subclasses are already
created is not supported by Sequel. You can also load extensions in
<code>after_connect</code> or perform any custom actions that you need.</p>

<h1>
<a name="available-sequel-specific-rake-tasks" class="anchor" href="#available-sequel-specific-rake-tasks"><span class="octicon octicon-link"></span></a>Available sequel specific rake tasks</h1>

<p>To get a list of all available rake tasks in your rails3 app, issue the usual in you app's root directory:</p>

<div class="highlight highlight-bash"><pre>rake -T
</pre></div>

<p>or if you don't have hooks in place to run commands with bundle by default:</p>

<div class="highlight highlight-bash"><pre>bundle <span class="nb">exec </span>rake -T
</pre></div>

<p>Once you do that, you will see the following rake tasks among others. These are the ones that sequel-rails added or replaced:</p>

<div class="highlight highlight-bash"><pre>rake db:create<span class="o">[</span>env<span class="o">]</span>                   <span class="c"># Create the database defined in config/database.yml for the current Rails.env</span>
rake db:create:all                    <span class="c"># Create all the local databases defined in config/database.yml</span>
rake db:drop<span class="o">[</span>env<span class="o">]</span>                     <span class="c"># Create the database defined in config/database.yml for the current Rails.env</span>
rake db:drop:all                      <span class="c"># Drops all the local databases defined in config/database.yml</span>
rake db:force_close_open_connections  <span class="c"># Forcibly close any open connections to the test database</span>
rake db:migrate                       <span class="c"># Migrate the database to the latest version</span>
rake db:migrate:down                  <span class="c"># Runs the "down" for a given migration VERSION.</span>
rake db:migrate:redo                  <span class="c"># Rollbacks the database one migration and re migrate up.</span>
rake db:migrate:reset                 <span class="c"># Resets your database using your migrations for the current environment</span>
rake db:migrate:up                    <span class="c"># Runs the "up" for a given migration VERSION.</span>
rake db:reset                         <span class="c"># Drops and recreates the database from db/schema.rb for the current environment and loads the seeds.</span>
rake db:schema:dump                   <span class="c"># Create a db/schema.rb file that can be portably used against any DB supported by Sequel</span>
rake db:schema:load                   <span class="c"># Load a schema.rb file into the database</span>
rake db:seed                          <span class="c"># Load the seed data from db/seeds.rb</span>
rake db:setup                         <span class="c"># Create the database, load the schema, and initialize with the seed data</span>
rake db:test:prepare                  <span class="c"># Prepare test database (ensure all migrations ran, drop and re-create database then load schema). This task can be run in the same invocation as other task (eg: rake db:migrate db:test:prepare).</span>
</pre></div>

<h1>
<a name="note-on-patchespull-requests" class="anchor" href="#note-on-patchespull-requests"><span class="octicon octicon-link"></span></a>Note on Patches/Pull Requests</h1>

<ul>
<li>Fork the project.</li>
<li>Make your feature addition or bug fix.</li>
<li>Add specs for it. This is important so I don't break it in a
future version unintentionally.</li>
<li>Commit, do not mess with rakefile, version, or history.
(if you want to have your own version, that is fine but bump version in a commit by itself I can ignore when I pull)</li>
<li>Send me a pull request. Bonus points for topic branches.</li>
</ul><h1>
<a name="the-sequel-rails-team" class="anchor" href="#the-sequel-rails-team"><span class="octicon octicon-link"></span></a>The sequel-rails team</h1>

<ul>
<li>Jonathan Tron (JonathanTron) - Current maintainer</li>
<li>Joseph Halter (JosephHalter) - Current maintainer</li>
</ul><h1>
<a name="previous-maintainer" class="anchor" href="#previous-maintainer"><span class="octicon octicon-link"></span></a>Previous maintainer</h1>

<p><a href="https://github.com/brasten/sequel-rails">Original project</a>:</p>

<ul>
<li>Brasten Sager (brasten) - Project creator</li>
</ul><h1>
<a name="contributors" class="anchor" href="#contributors"><span class="octicon octicon-link"></span></a>Contributors</h1>

<p>Improvements has been made by those awesome contributors:</p>

<ul>
<li>Benjamin Atkin (benatkin)</li>
<li>Gabor Ratky (rgabo)</li>
<li>Joshua Hansen (binarypaladin)</li>
<li>Arron Washington (radicaled)</li>
<li>Thiago Pradi (tchandy)</li>
<li>Sascha Cunz (scunz)</li>
<li>Brian Donovan (eventualbuddha)</li>
<li>Jack Danger Canty (JackDanger)</li>
<li>Ed Ruder (edruder)</li>
<li>Rafa≈Ç Rzepecki (dividedmind)</li>
<li>Sean Sorrell (rudle)</li>
<li>Saulius Grigaliunas (sauliusg)</li>
<li>Jacques Crocker (railsjedi)</li>
<li>Eric Strathmeyer (strathmeyer)</li>
<li>Jan Berdajs (mrbrdo)</li>
<li>Robert Payne (robertjpayne)</li>
<li>Kevin Menard (nirvdrum)</li>
<li>Chris Heisterkamp (cheister)</li>
</ul><h1>
<a name="credits" class="anchor" href="#credits"><span class="octicon octicon-link"></span></a>Credits</h1>

<p>The <a href="http://github.com/datamapper/dm-rails">dm-rails</a> team wrote most of the original code, I just sequel-ized it, but since then most of it as been either adapted or rewritten.</p>

<h1>
<a name="copyright" class="anchor" href="#copyright"><span class="octicon octicon-link"></span></a>Copyright</h1>

<p>Copyright (c) 2010-2013 The sequel-rails team. See <a href="http://github.com/brasten/sequel-rails/blob/master/LICENSE">LICENSE</a> for details.</p>
        </section>

        <footer>
          Sequel-rails is maintained by <a href="https://github.com/TalentBox">TalentBox</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>